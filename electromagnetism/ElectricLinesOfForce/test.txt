空間内任意の点に、符号大きさ自由な電荷が存在する場合
4行n列の行列に電荷の情報を記録。
任意の1列では、1?3行目にてある電荷の座標を特定し、4行目にて電荷の符号と大きさを指定する。
例えば(1,2,3)に30[C]の正電荷、(0,0,0)に15[C]の負電荷がある場合、次のようになる。
Qs=[1,2,3,30; 0,0,0,-15]

上記のように電荷を配置したとする。
また電気力線を書くための電場ベクトルの始点が(0.1,0,0)であるとする。
このベクトルが任意の電荷に接触するかどうかを調べよう。
電場ベクトルの線分と、始点から任意の電荷までを結ぶ線分の、2線分を考えよう
xy平面を正面に見た場合の角度θとyz平面を正面に見た場合の角度φが誤差率r未満で一致した場合で、電場ベクトルのx成分の方が電荷までを結ぶそれよりも大きい場合は接触する。
蛇足だが2つのベクトルが互いの整数倍になるか調べる方法では、誤差率やゼロ除算などの問題があってやりにくい。

%電荷の個数
CountQ=size(Qs);
CountQ=CountQ(1);

for p=[1:CountQ]
    %各電荷について処理を行う

    %着目電荷の座標(a,b,c)と符号付き電気量
    a=Qs(p,1);
    b=Qs(p,2);
    c=Qs(p,3);
    Q=Qs(p,4);

    %着目電荷と電場ベクトル始点とを結ぶ線分
    AP=[x-a,y-b,z-c];

    %線分APの角度θを区間[-π/2,π/2]の範囲で求める
    thetaOfAP=atan(AP(2)/AP(1));
    %線分APの角度φを区間[-π/2,π/2]の範囲で求める
    phiOfAP=atan(AP(3)/AP(2));

    %電場ベクトルEに対しても同じことをする。
    thetaOfE=atan(E(2)/E(1));
    phiOfE=atan(E(3)/E(2));

    %φとθそれぞれの誤差(rad)が、r未満であるか調べる
    isTouchTheta=abs(thetaOfAP(1)-thetaOfE(1))<=r;
    isTouchPhi=abs(phiOfAP(1)-phiOfE(1))<=r;    

    if (isTouchTheta) && (isTouchPhi)
    %電場ベクトルが電荷に重なり得る方向である場合
        if abs(AP(1))<abs(E(1))
        %電場ベクトルのほうが長いなら
            i=NaN;
            return;
        end

    end
end